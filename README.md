```
                                    ⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⢀⣀⣤⣤⣴⣶⡆⠀⣶⣶⣦⣤⣤⣄⠀⢠⣾⣿⣦
                                    ⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⣀⡀⢰⣿⣿⣿⣿⣿⣿⣿⡇⠀⣿⣿⣿⣿⣿⣿⡄⠘⢿⣿⠟
                                    ⠀⠀⠀⠀⠀⠀⠀⠀⢀⣴⣾⣿⣧⠀⢻⣿⣿⣿⣿⣿⣿⡇⠀⣿⣿⣿⣿⣿⣿⣿⠂⢠⣠⣤⣶⣦⡀
                                    ⠀⠀⠀⠀⠀⠀⣠⣾⣿⣿⣿⣿⣿⣇⠈⢿⣿⣿⣿⣿⣿⡇⠀⣿⣿⣿⣿⣿⣿⠏⢀⣿⣿⣿⣿⣿⣿⣦⡀
                                    ⠀⠀⠀⠀⠀⠘⢿⣿⣿⣿⣿⣿⣿⣿⡆⠘⣿⣿⣿⣿⣿⡇⠀⣿⣿⣿⣿⣿⡏⠀⣾⣿⣿⣿⣿⣿⣿⡿⠋⢀
                                    ⠀⠀⠀⣴⣿⣦⡀⠙⢿⣿⣿⣿⣿⣿⣿⡄⠸⣿⣿⣿⣿⡇⠀⣿⣿⣿⣿⡟⠀⣼⣿⣿⣿⣿⣿⣿⠟⢀⣴⣿⣧
                                    ⠀⠀⣼⣿⣿⣿⣿⣦⡀⠙⢿⣿⣿⣿⣿⣷⡀⢹⣿⣿⣿⡇⠀⣿⣿⣿⡿⠁⣰⣿⣿⣿⣿⣿⠟⢁⣴⣿⣿⣿⣿⣧
                                    ⠀⣼⣿⣿⣿⣿⣿⣿⣿⣦⡀⠙⢿⣿⣿⣿⣧⠀⢻⣿⣿⡇⠀⣿⣿⣿⠃⢰⣿⣿⣿⣿⠟⢁⣴⣿⣿⣿⣿⣿⣿⣿⣧
                                    ⠀⠛⠿⢿⣿⣿⣿⣿⣿⣿⣿⣦⡀⠙⢿⣿⣿⣇⠀⢿⣿⡇⠀⣿⣿⠇⢠⣿⣿⣿⠟⢁⣴⣿⣿⣿⣿⣿⣿⣿⣿⡿⠟⠃
                                    ⣼⣶⣤⣄⡈⠙⠛⠿⣿⣿⣿⣿⣿⣦⡀⠙⢿⣿⡆⠈⠛⠃⠀⠛⠋⠀⣾⣿⠟⠁⣠⣾⣿⣿⣿⣿⡿⠿⠛⠉⣀⣠⣴⣶⡄
                                    ⣿⣿⣿⣿⣿⣿⣶⣤⣀⡉⠙⠻⢿⣿⣿⣦⠀⠁⠀⠀⠀⠀⠀⠀⠀⠀⠈⠁⢠⣾⣿⣿⠿⠛⠋⢁⣠⣴⣶⣿⣿⣿⣿⣿⣿⡀
                                    ⢻⣿⣿⣿⣿⣿⣿⣿⣿⣿⣷⣦⣤⣀⠉⠃⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠈⠋⢁⣀⣤⣶⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣧
                                    ⢸⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⡏⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠘⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⡟⠁ ⣠⣶⣄
                                    ⠀⣤⣤⣤⣤⣤⣤⣤⣤⣤⣤⣤⣤⣤⡄⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⣤⣤⣤⣤⣤⣤⣤⣤⣤⣤⣤⣤⣤⣤⡄⠀⢻⣿⣿⡿
                                    ⠀⠘⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⠿⠓⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⣸⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⡿⠂⠀⠙⠋
                                    ⠀⠀⠘⣿⣿⣿⣿⣿⠿⠛⠋⢁⣠⣤⣶⣧⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⢰⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⠟⠋
                                    ⠀⠀⠀⠘⠟⠋⢉⣀⣤⣶⣿⣿⣿⣿⠟⠁⣠⣦⣄⡀⠀⠀⠀⠀⠀⠀⣤⣦⡈⠻⣿⣿⣿⣿⣿⣿⣿⣿⣿⡿⠛⠁
                                    ⠀⠀⠀⠀⠀⠘⢿⣿⣿⣿⣿⣿⠟⠁⣠⣾⣿⣿⣿⣿⣿⣶⣶⣾⣧⠀⢻⣿⣿⣦⡈⠻⣿⣿⣿⣿⡿⠟⠉
                                    ⠀⠀⠀⠀⠀⠀⠀⠙⠿⣿⡟⠁⣠⣾⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣇⠈⠿⢿⣿⣿⣦⡈⠻⠛⠉
                                    ⠀⠀⠀⠀⠀⠀⠀⠀⠀⠈⠀⠺⢿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⠋⢀⣤⣤⡈⠙⠋⠁
                                    ⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠉⠙⠛⠻⠿⠿⠿⠿⠿⠿⠇⠀⣿⣿⣿⡇
                                    ⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠈⠙⠋

                         /██   /██   /██   /██   /██████    /██████     /██████    /██      /██   /███████
                        | ██  | ██  | ███ | ██  |_  ██_/   /██__  ██   /██__  ██  | ███    /███  | ██__  ██
                        | ██  | ██  | ████| ██    | ██    | ██  \__/  | ██  \ ██  | ████  /████  | ██  \ ██
                        | ██  | ██  | ██ ██ ██    | ██    | ██        | ████████  | ██ ██/██ ██  | ███████/
                        | ██  | ██  | ██  ████    | ██    | ██        | ██__  ██  | ██  ███| ██  | ██____/
                        | ██  | ██  | ██\  ███    | ██    | ██    ██  | ██  | ██  | ██\  █ | ██  | ██
                        |  ██████/  | ██ \  ██   /██████  |  ██████/  | ██  | ██  | ██ \/  | ██  | ██
                         \______/   |__/  \__/  |______/   \______/   |__/  |__/  |__/     |__/  |__/
```
<p align="right"><b><sub>Version: 1.1.0</sub></b></p>

<p align="center"><b>Authors</b></p>
<p align="center">
Nathan Barros de Souza<br>
Luís Fernando Mercier Franco<br></p>

# <p align="center">NPT/NVT-Monte Carlo Simulation of Mixtures of <br>Anisomorphic Hard Convex Bodies: <br>Ellipsoids of revolution, Spherocylinders, and Cylinders</p>

## Contents
1. [Disclaimer](#disclaimer)
2. [Overview](#overview)
3. [Features](#features)
4. [Language](#language)
5. [Building and Compiling](#installation)
6. [Data Input](#datainput)
7. [Files and Folders](#filesandfolders)
8. [Running the Code](#running)
9. [Reporting Errors](#reporting)
10. [Citing Us](#citation)

## <a name="disclaimer"></a>Disclaimer

<p align="justify">
The authors make no warranties about the use of this software. The authors hold no liabilities for the use of this software. The authors do not 
 recommend the use of this software whatsoever. The algorithm is made freely available to assist researchers in studies involving mixtures of hard convex bodies.
 All information contained herein regarding any specific methodology does not constitute or imply its endorsement or recommendation by the authors.
</p>

## <a name="overview"></a>Overview
<p align="justify">
  This NVT/NPT-Monte Carlo algorithm was designed to evaluate the thermodynamic behavior of mixtures of anisomorphic hard convex bodies (HCB), namely: ellipsoids of revolution (EOR), spherocylinders (SPC), and cylinders (CYL). Here, the HCB interact only through a purely repulsive hard-core potential, which means that a single check of overlapping configurations is sufficient to validate a random trial move. It is also possible to select a force field to account for the attractive interactions in the perturbed system (<i>NVT</i> only), but they do not affect the probability distribution function of accepting random trial moves. To search for overlapping configurations, different methods were applied depending on the molecular geometry: for mixtures of anisomorphic EOR particles, the Perram-Wertheim (PW) method (<a href="https://doi.org/10.1016/0021-9991(85)90171-8"><b>J. Comput. Phys.</b>, 58, 409-416, 1985</a>) is used; for mixtures of anisomorphic SPC particles, the Vega-Lago (VL) method (<a href="https://doi.org/10.1016/0097-8485(94)80023-5"><b>Comput. Chem.</b>, 18, 55-59, 1994</a>) is used; and for mixtures of CYL particles, a modified version of Lopes <i>et al.</i> (mLCYL) algorithm (<a href="https://doi.org/10.1063/5.0040942"><b>J. Chem. Phys.</b>, 154, 104902, 2021</a>) is used.
</p>

<p align="justify">
  This NVT/NPT-Monte Carlo algorithm only treats mixtures of anisomorphic HCB, that is, mixtures of HCB with same geometry but different aspect ratios*. Mixtures of isomorphic HCB are also possible. The geometries are illustrated below.
</p>

| | | |
|:---:|:---:|:---:|
| | | |
| **Oblate Ellipsoids of Revolution** | **Spheres (Degenerate)** | **Prolate Ellipsoids of revolution** |
| ![oblate_eor](https://user-images.githubusercontent.com/73966482/220217625-863c0551-3e97-4199-860f-f436746c32da.gif) | ![sphere_eor](https://user-images.githubusercontent.com/73966482/220217633-d9a5dc8b-d624-456a-86d8-22f5d5bb6954.gif) | ![prolate_eor](https://user-images.githubusercontent.com/73966482/220217635-92cd7b1e-c5ef-41a6-af07-f52981402b5e.gif) |
| **Thin Spherocylinders** | **Spheres (Degenerate)** | **Thick Spherocylinders** |
| ![short_rod](https://user-images.githubusercontent.com/73966482/220220955-c1020dbe-1ed1-439a-82b5-4b9285e0deab.gif) | ![sphere_eor](https://user-images.githubusercontent.com/73966482/220217633-d9a5dc8b-d624-456a-86d8-22f5d5bb6954.gif) | ![long_rod](https://user-images.githubusercontent.com/73966482/220221125-03a64ead-b267-42fc-8693-2e71b2e91ca3.gif) |
| **Oblate Cylinders** | **Equilateral Cylinders** | **Prolate Cylinders** |
| ![oblate_cyl](https://user-images.githubusercontent.com/73966482/220222417-9817f7b8-2905-44de-a75f-bb5723921b89.gif) | ![equilateral_cyl](https://user-images.githubusercontent.com/73966482/220222480-c467f205-8ca0-4434-b1ed-328b12710627.gif) | ![prolate_cyl](https://user-images.githubusercontent.com/73966482/220222442-54428487-292d-4050-9bb5-1a3db933ac3a.gif) |
| | | |

<sub>*The mLCYL algorithm also searches for overlapping configurations between cylinders and spheres (<b>Version 1.1.0</b>).</sub>

<p align="justify">
  This NVT/NPT-Monte Carlo algorithm can be used, <i>e. g.</i>, for mixtures of oblate and prolate ellipsoids of revolution, oblate/prolate ellipsoids of revolution and spheres (degenerate case), thin and thick spherocylinders, thin/thick spherocylinders and spheres (degenerate case), oblate (disk) and prolate (rod) cylinders, oblate/prolate cylinders and equilateral cylinders, and cylinders and spheres. Some NVT-Monte Carlo simulations of these multicomponent mixtures are illustrated below.
</p>

| | | |
|:---:|:---:|:---:|
| | | |
| NVT-Monte Carlo (EOR) | NVT-Monte Carlo (SPC) | NVT-Monte Carlo (CYL) |
| ![all_eor](https://user-images.githubusercontent.com/73966482/220226516-0ac6a160-2d06-4100-bdc4-75cd84a28adb.gif) | ![all_spc](https://user-images.githubusercontent.com/73966482/220227393-6c56c6c4-5857-4388-ad79-98e78814d81d.gif) | ![all_cyl](https://user-images.githubusercontent.com/73966482/220225783-9bcec901-1fa2-4a65-954c-cfda4d942b5d.gif) |
| | | |

## <a name="features"></a>Features
<p align="justify">
The following features are supported in the current version:
</p>

1. Initial Configurations
    - Simple Cube (for pure components and mixtures)
    - Body-Centered Cube (for pure components and mixtures)
    - Face-Centered Cube (for pure components and mixtures)
    - Random Structure (for pure components and mixtures)

2. Ensembles
    - Canonical (NVT)
    - Isothermal-Isobaric (NPT)
    - Isothermal-Isostress (N&sigma;T)

3. Moves
    - Translation
    - Rotation (Quaternion Algebra)
    - Cubic Expansions/Compressions (Isotropic)
    - Triclinic Expansions/Compressions (Anisotropic)

4. Lattice Reduction Algorithms
    - <a href="https://doi.org/10.1063/1.1901585">Gottwald</a>
    - <a href="https://doi.org/10.1007/BF01457454">Lenstra-Lenstra-Lovász</a>

5. Force Fields
    - Spherical Square Well (perturbed system only*)

<sub>*This means that the potential does not affect the molecular configuration of the system, which is solely defined by the purely repulsive hard-core potential.</sub>

## <a name="language"></a>Language
<p align="justify">
  The main program, subroutines, modules, and functions contain some explanatory comments and are mainly written in Fortran 95. The user can look for more information on Fortran language <a href="https://docs.oracle.com/cd/E19957-01/806-3591/C_f95.html">here</a>.
</p>

## <a name="installation"></a>Building and Compiling
<p align="justify">
  Firstly, you must clone this GitHub repository using the command below:
</p>

```
> git clone https://github.com/LESC-Unicamp/monte_carlo_mixtures_ellipsoids_spherocylinders_cylinders
```

<p align="justify">
  After that, change to the repository directory on your device and open the <code>/src/</code> folder:
</p>

```
> cd monte_carlo_mixtures_ellipsoids_spherocylinders_cylinders/src/
```

<p align="justify">
  The <code>/src/</code> folder contains two 'Makefiles' that you can use to compile the code. Each of these 'Makefiles' contains different compilation options. You can use either the 'makefile' to compile the standard version of the code or the 'makefile-debug' to compile the debug version of the code.
</p>

<p align="justify">
  To compile it, first remove any object and module files using the <i>clean</i> command:
</p>
  
```> make clean```

<p align="justify">
  Then, to compile the source code, run one of the commands below, depending on the chosen compilation type:
</p>

| **Compilation type** | **Command** |
|:---:|:---:|
| <a href="https://github.com/LESC-Unicamp/Monte-Carlo-Mixtures-of-Ellipsoids-Spherocylinders-Cylinders/blob/main/src/makefile-debug">Debug</a> | ```make -f makefile.debug``` |
| <a href="https://github.com/LESC-Unicamp/Monte-Carlo-Mixtures-of-Ellipsoids-Spherocylinders-Cylinders/blob/main/src/makefile">Standard</a> | ```make -f makefile``` |

<p align="justify">
  Each of these commands will produce an executable with a specific name depending on the chosen compilation type. Both executables can be found in the folder <code>/bin/</code> in the repository directory. Before running the program, there are a few initialization variables and options you need to set up.
</p>

## <a name="datainput"></a>Data Input

<p align="justify">
  Apart from the executable file, the <code>/bin/</code> folder contains some initialization files that need to be set up.
</p>

### The Configuration File<br><a href="https://github.com/LESC-Unicamp/Monte-Carlo-Mixtures-of-Ellipsoids-Spherocylinders-Cylinders/blob/main/bin/ini_config.ini"><sub>ini_config.ini</sub></a>

<p align="justify">
  This file is used to set up the molecular geometry and the molecular configuration, including aditional information on the random structure (if selected). The table below shows some options that can be used to define the configuration parameters:
</p>

| Name<br> ______________________ | String Name<br> _________________________________ | Definition<br> _______________________________ | Options<br> _________________________________________________ |
|:---:|:---:| --- | --- |
| Geometry selection | <code>geometry_selection</code> | Used to select the molecular geometry | <ul><li><code>EOR</code> for ellipsoids of revolution</li><li><code>SPC</code> for spherocylinders</li><li><code>CYL</code> for cylinders</li></ul> |
| Configuration selection | <code>molecular_configuration</code> | Used to select the initial configuration | <ul><li><code>SC</code> for a simple cubic structure</li><li><code>BCC</code> for a body-centered cubic structure</li><li><code>FCC</code> for a face-centered cubic structure</li><li><code>RND</code> for a random cubic structure</li></ul> |
| Unrotated axis | <code>unrotated_axis</code> | Used to select the unrotated reference axis (initial configurations only) | <ul><li><code>X</code> to select the _x_-axis</li><li><code>Y</code> to select the _y_-axis</li><li><code>Z</code> to select the _z_-axis</li></ul> |
| Quaternion angle | <code>quaternion_angle</code> | Used to select the orientation angle in degrees (initial configurations only) | Any <code>FLOAT</code> number |
| Packing fraction<br> (<code>RND</code> only) | <code>packing_fraction_rnd</code> | Used to define the initial volume of the simulation box (random configuration only)<br>**NOTE**: Smaller packing fractions (larger box volumes) are recommended | Any positive, non-zero <code>FLOAT</code> number between 0 and 1 |
| Reduced pressure¹<br> (<code>RND</code> only) | <code>pressure_npt_rnd</code> | Used to correct the initial packing fraction of the simulation box to the target packing fraction (random configuration only)<br>**NOTE**: Higher pressures are recommended | Any positive, non-zero <code>FLOAT</code> number |
| Preset configuration | <code>preset_initial_configuration</code> | Used to replace the current configuration with a previously generated configuration<br> **NOTE**: This overrides most of the simulation settings | <ul><li><code>.TRUE.</code> to use a preset configuration</li><li><code>.FALSE.</code> to use the current configuration</li></ul> |

<p align="justify">
  <sup>¹P<sup>*</sup> = P&sigma;<sub>0</sub>³/(k<sub>B</sub>T), where <i>P</i> is the real pressure, <i>k<sub>B</sub></i> is the Boltzmann constant, <i>T</i> is the absolute temperature, and <i>&sigma;<sub>0</sub></i> is a reference diameter, such that &sigma;<sub>0</sub> = 1Å.</sup>
</p>

<p align="justify">
  <b>OBS.</b>: When selecting a preset configuration, the user will be asked to enter a 14-character code at some point. This code is part of the name of a configuration file inside the '/bin/Initial_Configuration/' directory. The filename says something like:
</p>

<code>[DATE][HOUR]\_initconf\_[CONFIGURATION]\_[GEOMETRY].xyz</code>

<p align="justify">
  The 14-character code is the [DATE][HOUR] descriptor of the filename. You can open this file using any text editor and edit some simulation settings that you find relevant. Please be reminded that editing anything in this file, except the reduced pressure and absolute temperature, may cause the program to detect overlapping configurations in the initial structure.
</p>

### The Control File<br><a href="https://github.com/LESC-Unicamp/Monte-Carlo-Mixtures-of-Ellipsoids-Spherocylinders-Cylinders/blob/main/bin/ini_control.ini"><sub>ini_control.ini</sub></a>

<p align="justify">
  This file is used to set up some control variables, such as data printing, seed type, and potential type. The table below shows some options that can be used to define the control parameters:
</p>

| Name<br> ______________________ | String Name<br> _________________________________ | Definition<br> _________________________________ | Options<br> _________________________________________________ |
|:---:|:---:| --- | --- |
| Trajectory printing | <code>print_trajectory</code> | Used to specify whether the trajectory files will be written out or not | <ul><li><code>Y</code> to write out the trajectory file</li><li><code>N</code> to NOT write out the trajectory file</li></ul> |
| Seed type | <code>fixed_seed</code> | Used to control the type of pseudorandom number generator seed | <ul><li><code>Y</code> for a fixed seed</li><li><code>N</code> for a random seed</li></ul> |
| Backup control | <code>backup_file</code> | Used to specify whether a backup file will be generated every <code>saving_frequency</code> cycles | <ul><li><code>Y</code> to generate a backup file</li><li><code>N</code> to NOT generate a backup file</li></ul> |
| Restore backup | <code>restore_backup</code> | Used to restore data from previous, unfinished simulations | <ul><li><code>Y</code> to restore data from a previous simulation</li><li><code>N</code> to use current simulation data</li></ul> |
| Potential type | <code>potential_type</code> | Used to control the type of potential applied in the perturbed system | <ul><li><code>HARDCORE</code> for a purely repulsive hard-core potential<br>(no attractive potential)</li><li><code>SQUAREWELL</code> for a spherically symmetric square-well potential</li></ul> |
| Potential energy printing | <code>potential_production_only</code> | Used to specify whether the potential energy data will be written out during the whole <i>NVT</i>-simulation or only for production-related cycles | <ul><li><code>Y</code> to write out the potential data only for production-related cycles</li><li><code>N</code> to write out the potential data for both equilibration- and production-related cycles</li></ul> |
| TPT¹ coefficients printing | <code>coefficients_calculation</code> | Used to specify whether the first- and second-order coefficients of a high-temperature expansion of the Helmholtz free energy will be calculated or not<br>(<i>NVT</i>-simulation only) | <ul><li><code>Y</code> to compute the perturbation coefficients, including the full Helmholtz free energy of the perturbed system</li><li><code>N</code> to skip the computation of the perturbation coefficients</li></ul> |

<p align="justify">
  <sup>¹TPT stands for thermodynamic perturbation theory.</sup>
</p>

<p align="justify">
  <b>OBS.</b>: When selecting to restore data from a backup file, the user will be asked to enter a 14-character code at some point. This code is part of the name of two configuration files ( inside the '/bin/Backup/' directory. The filename says something like:
</p>

<code>[DATE][HOUR]\simulation.backup</code>

<code>[DATE][HOUR]\variables.backup</code>

### The Monte Carlo File<br><a href="https://github.com/LESC-Unicamp/Monte-Carlo-Mixtures-of-Ellipsoids-Spherocylinders-Cylinders/blob/main/bin/ini_montecarlo.ini"><sub>ini_montecarlo.ini</sub></a>

<p align="justify">
  This file is used to set up the number of simulation cycles, maximum displacements, ensemble type, and lattice reduction algorithm (if anisotropic volume changes are considered). The table below shows some options that can be used to define the simulation parameters:
</p>

| Name<br> ______________________ | String Name<br> _________________________________ | Definition<br> _______________________________ | Options<br> _________________________________________________ |
|:---:|:---:| --- | --- |
| Number of cycles | <code>max_cycles</code> | Used to define the maximum number of simulation cycles<br> **NOTE**: A cycle is defined as <i>N</i> attempts to displace a random particle in the system or a single attempt to change the volume of the box | Any positive, non-zero <code>INTEGER</code> number |
| Number of equilibration cycles | <code>equilibration_cycles</code> | Used to define the number of equilibration cycles within the maximum number of cycles | Any positive, non-zero <code>INTEGER</code> number less than the maximum number of cycles |
| Saving frequency | <code>saving_frequency</code> | Used to define how often simulation results are written out | Any positive, non-zero <code>INTEGER</code> number<br> **NOTE**: _1_ is the highest frequency, meaning that the results will be written out every simulation cycle |
| Adjustment frequency | <code>adjustment_frequency</code> | Used to define how often displacement adjustments are carried out | Any positive, non-zero <code>INTEGER</code> number<br> See the observation note below for more information |
| Adjustment frequency<br> (<code>RND</code> only) | <code>adjustment_frequency_rnd</code> | Used to define how often displacement adjustments are carried out (random configuration only) | Any positive, non-zero <code>INTEGER</code> number<br> **NOTE**: _1_ is the highest frequency, meaning that the displacements will be adjusted every simulation cycle |
| Maximum translational displacement | <code>max_translational_displc</code> | Used to define the maximum translational displacement \[+/-\] in Å | Any non-zero <code>FLOAT</code> number |
| Maximum translational displacement<br> (<code>RND</code> only) | <code>max_translational_displc_rnd</code> | Used to define the maximum translational displacement \[+/-\] in Å (random configuration only) | Any non-zero <code>FLOAT</code> number |
| Maximum rotational displacement | <code>max_rotational_displc</code> | Used to define the maximum rotational displacement \[+/-\] in radians | Any non-zero <code>FLOAT</code> number |
| Maximum rotational displacement<br> (<code>RND</code> only) | <code>max_rotational_displc_rnd</code> | Used to define the maximum rotational displacement \[+/-\] in radians (random configuration only) | Any positive, non-zero <code>FLOAT</code> number |
| Maximum isotropic volumetric displacement | <code>max_volumetric_displc_iso</code> | Used to define the maximum isotropic volumetric displacement \[+/-\] in Å³ | Any non-zero <code>FLOAT</code> number |
| Maximum anisotropic volumetric displacement | <code>max_volumetric_displc_aniso</code> | Used to define the maximum anisotropic volumetric displacement \[+/-\] in Å³ | Any non-zero <code>FLOAT</code> number |
| Maximum isotropic volumetric displacement<br> (<code>RND</code> only) | <code>max_volumetric_displc_iso_rnd</code> | Used to define the maximum isotropic volumetric displacement \[+/-\] in Å³ (random configuration only) | Any non-zero <code>FLOAT</code> number |
| Maximum anisotropic volumetric displacement<br> (<code>RND</code> only) | <code>max_volumetric_displc_aniso_rnd</code> | Used to define the maximum volumetric displacement \[+/-\] in Å³ (random configuration only) | Any non-zero <code>FLOAT</code> number |
| Minimum volumetric displacement<br> (<code>RND</code> only) | <code>min_volumetric_displc_rnd</code> | Used to define the minimum volumetric displacement \[+/-\] in Å³ (random configuration only) | Any non-zero <code>FLOAT</code> number such that its absolute value is less than the maximum isotropic and anisotropic volumetric displacements |
| Maximum box distortion | <code>max_box_distortion</code> | Used to define the maximum box distortion before carrying out a lattice reduction technique | Any positive <code>FLOAT</code> number greater than 1 |
| Maximum box length distortion | <code>max_box_length_ratio</code> | Used to define the maximum ratio between the lengths of the edges of the box. | Any positive, non-zero <code>FLOAT</code> number|
| Maximum box angle distortion | <code>max_box_angle_degree</code> | Used to define the maximum deformation angle (in degrees) between the edges of the box in comparison to a perfect cube (90° + <i>x</i>). | Any positive, non-zero <code>FLOAT</code> number|
| Lattice reduction algorithm | <code>lattice_reduction</code> | Used to define the algorithm that carries out the lattice reduction technique | <ul><li><code>GOTTWALD</code> for the algorithm used in the <a href="https://doi.org/10.1063/1.4767529">floppy-box Monte Carlo</a> method</li><li><code>LLL</code> for the <a href="https://doi.org/10.1007/BF01457454">Lenstra-Lenstra-Lovász</a> algorithm</li></ul> |
| Ensemble type | <code>ensemble</code> | Used to define the statistical ensemble | <ul><li><code>NVT</code> for the canonical ensemble</li><li><code>NPT</code> for the isothermal-isobaric (or isothermal-isostress) ensemble</li></ul> |

<p align="justify">
  <b>OBS. I</b>: The number of production cycles is defined automatically by subtracting the number of equilibration cycles from the total number of cycles.
</p>

<p align="justify">
  <b>OBS. II</b>: <i>Adjustment frequency</i>: Let's call the number of trialed moves <b>n_trialed</b>, the acceptance ratio of that move <b>acc_ratio</b>, the number of particles <b>N</b>, and the adjustment frequency <b>n_adjust</b>.
</p>

- For translational and rotational movements, adjustments to the maximum displacements only take effect when <br><b>n_trialed</b> ≥ (<b>N</b> * <b>n_adjust</b>) * <b>acc_ratio</b>.
- For isotropic and anisotropic volume changes, adjustments to the maximum displacements only take effect when <br><b>n_trialed</b> ≥ <b>n_adjust</b> * <b>acc_ratio</b>.

<p align="justify">
  <b>OBS. III</b>: The box distortion is defined as the product of the total surface area and perimeter of the box divided by its volume. We normalize the box distortion factor by dividing it by 72, which corresponds to minimum box distortion possible (perfect cube). In that case, 1 is a perfect cube and higher values represent triclinic or non-cubic orthorhombic structures.
</p>

### The Potential File<br><a href="https://github.com/LESC-Unicamp/Monte-Carlo-Mixtures-of-Ellipsoids-Spherocylinders-Cylinders/blob/main/bin/ini_potential.ini"><sub>ini_potential.ini</sub></a>

<p align="justify">
  This file is used to set up variables related to the chosen force field. The table below shows some options that can be used to define the force field parameters:
</p>

| Name<br> ________________________ | String Name<br> _______________________ | Definition<br> _________________________________ | Options<br> _______________________________________ |
|:---:|:---:| --- | --- 
| Attrative range points<br><i>Square-well potential</i> | <code>lambda_points</code> | Used to define the number of attractive range points for which the potential will be computed | Any positive, non-zero <code>INTEGER</code> number |
| Attrative range values<br><i>Square-well potential</i> | <code>lambda_values</code> | Used to define the attractive range of the potential | Any positive <code>FLOAT</code> number greater than 1|
| Reduced temperature¹ | <code>reduced_temperature</code> | Used to define the reduced temperature of the system | Any positive, non-zero <code>FLOAT</code> number |
| Minimum number of blocks | <code>min_blocks</code> | <b>Block-average parameter</b>:<br>Used to define the minimum number of blocks to compute the statistical inefficiency of a dataset | Any positive, non-zero <code>INTEGER</code> number |
| Maximum number of blocks | <code>max_blocks</code> | <b>Block-average parameter</b>:<br>Used to define the maximum number of blocks to compute the statistical inefficiency of a dataset | Any positive <code>INTEGER</code> number greater than the minimum number of blocks |

<p align="justify">
  <sup>¹T<sup>*</sup> = (k<sub>B</sub>T)/&varepsilon;, where <i>T</i> is the absolute temperature in Kelvin, <i>k<sub>B</sub></i> is the Boltzmann constant, and <i>&varepsilon;</i> is the well depth of the potential.</sup>
</p>

<p align="justify">
  <b>OBS. I</b>: If the number of attractive range points is greater than 1, the attractive range values must be entered successively on the same respective line, separated by a single space, as shown in the provided *.ini file.
</p>

<p align="justify">
  <b>OBS. II</b>: The block-average parameters are used by a block-average subroutine that computes the perturbation coefficients from the potential dataset.
</p>

### The Probabilities File<br><a href="https://github.com/LESC-Unicamp/Monte-Carlo-Mixtures-of-Ellipsoids-Spherocylinders-Cylinders/blob/main/bin/ini_probabilities.ini"><sub>ini_probabilities.ini</sub></a>

<p align="justify">
  This file is used to set up the probability of trial moves. The table below shows some options that can be used to define the probability parameters:
</p>

| Name<br> ______________________ | String Name<br> _________________________________ | Definition<br> _______________________________ | Options<br> _________________________________________________ |
|:---:|:---:| --- | --- |
| Probability of movement | <code>prob_movement</code> | Used to define the probability a movement (translation/rotation) will occur during a trial move | Any positive <code>FLOAT</code> number between 0 and 1 |
| Probability of movement<br> (<code>RND</code> only) | <code>prob_movement_rnd</code> | Used to define the probability a movement (translation/rotation) will occur during a trial move (random configuration only) | Any positive <code>FLOAT</code> number between 0 and 1 |
| Probability of translation | <code>prob_translation</code> | Used to define the probability a translation will occur during a trial movement | Any positive <code>FLOAT</code> number between 0 and 1 |
| Probability of translation<br> (<code>RND</code> only) | <code>prob_translation_rnd</code> | Used to define the probability a translation will occur during a trial movement (random configuration only) | Any positive <code>FLOAT</code> number between 0 and 1 |
| Probability of isotropic volume change | <code>prob_volume_change_isotropic</code> | Used to define the probability an isotropic change will occur during a trial volume change | Any positive <code>FLOAT</code> number between 0 and 1 |
| Probability of isotropic volume change (<code>RND</code> only) | <code>prob_volume_change_isotropic_rnd</code> | Used to define the probability an isotropic change will occur during a trial volume change (random configuration only) | Any positive <code>FLOAT</code> number between 0 and 1 |

<p align="justify">
  <b>OBS. I</b>: The probability of a volume change is defined automatically by subtracting the probability of movement from 1. Similarly, the probability of rotation is defined by subtracting the probability of translation from 1. Finally, the probability of an anisotropic volume change is defined by subtracting the probability of the isotropic change from 1.
</p>

<p align="justify">
  <b>OBS. II</b>: If the <i>NVT</i> ensemble is selected, the probability of movement is replaced by 1. If the <i>NPT</i> ensemble is selected, the probability of movement cannot be 1, which means that the probability of volume change cannot be set to 0.
</p>

### The Acceptance Ratios File<br><a href="https://github.com/LESC-Unicamp/Monte-Carlo-Mixtures-of-Ellipsoids-Spherocylinders-Cylinders/blob/main/bin/ini_ratios.ini"><sub>ini_ratio.ini</sub></a>

<p align="justify">
  This file is used to set up the acceptance ratio thresholds of trial moves. The table below shows some options that can be used to define the threshold parameters:
</p>

| Name<br> ______________________ | String Name<br> _________________________________ | Definition<br> _______________________________ | Options<br> _________________________________________________ |
|:---:|:---:| --- | --- |
| Translational threshold | <code>ratio_translation</code> | Used to define the acceptance threshold of translational moves | Any positive <code>FLOAT</code> number between 0 and 1 |
| Rotational threshold | <code>ratio_rotation</code> | Used to define the acceptance threshold of rotational moves | Any positive <code>FLOAT</code> number between 0 and 1 |
| Isovolumetric threshold | <code>ratio_volume_iso</code> | Used to define the acceptance threshold of isotropic volumetric moves | Any positive <code>FLOAT</code> number between 0 and 1 |
| Anisovolumetric threshold | <code>ratio_volume_aniso</code> | Used to define the acceptance threshold of anisotropic volumetric moves | Any positive <code>FLOAT</code> number between 0 and 1 |

<p align="justify">
  <b>OBS.</b>: Adjustments to maximum diplacements are only made during the equilibration phase for every <code>adjustment_frequency</code> cycles. Let's call the number of accepted moves <b>n_accepted</b> and the number of trialed moves <b>n_trialed</b>. If <b>n_accepted</b> / <b>n_trialed</b> > <b>threshold</b>, the corresponding maximum displacement is increased by 5% of its current value; otherwise, it is decreased by 5% of its current value.
</p>

### The System File<br><a href="https://github.com/LESC-Unicamp/Monte-Carlo-Mixtures-of-Ellipsoids-Spherocylinders-Cylinders/blob/main/bin/ini_system.ini"><sub>ini_system.ini</sub></a>

<p align="justify">
  This file is used to set up system-related variables, including geometric properties. The table below shows some options that can be used to define the system parameters:
</p>

| Name<br> ______________________ | String Name<br> _________________________________ | Definition<br> _______________________________ | Options<br> _________________________________________________ |
|:---:|:---:| --- | --- |
| Packing fraction | <code>packing_fraction</code> | Used to define the target packing fraction of an <b>NVT</b>-simulation or the initial packing fraction (initial volume) of an <b>NPT</b>-simulation | Any positive, non-zero <code>FLOAT</code> number between 0 and 1 |
| Number of components | <code>components</code> | Used to define the number of components in the mixture | Any positive, non-zero <code>INTEGER</code> number |
| Spherical components | <code>spherical_components</code> | Used to identify the spherical components in the mixture | <ul><li><code>T</code> if the component is spherical</li><li><code>F</code> if the component is nonspherical</li></ul> |
| Molecular diameter | <code>diameter</code> | Used to define the molecular diameter in Å of each component in the mixture | Any positive, non-zero <code>FLOAT</code> number |
| Molecular length | <code>length</code> | Used to define the molecular length in Å of each component in the mixture | Any positive, non-zero <code>FLOAT</code> number |
| Mole fraction | <code>molar_fraction</code> | Used to define the mole fraction of each component in the mixture | Any positive, non-zero <code>FLOAT</code> number between 0 and 1 |
| Number of particles | <code>number_of_particles</code> | Used to define the total number of particles | Any positive, non-zero <code>INTEGER</code> number |
| Temperature | <code>absolute_temperature</code> | Used to define the temperature of the system in K | Any positive, non-zero <code>FLOAT</code> number |
| Reduced pressure¹ | <code>reduced_pressure</code> | Used to define the reduced pressure (only used in an <b>NPT</b>-simulation) | Any positive, non-zero <code>FLOAT</code> number |

<p align="justify">
  <sup>¹P<sup>*</sup> = P&sigma;<sub>0</sub>³/(k<sub>B</sub>T), where <i>P</i> is the real pressure, <i>k<sub>B</sub></i> is the Boltzmann constant, <i>T</i> is the absolute temperature, and <i>&sigma;<sub>0</sub></i> is a reference diameter, such that &sigma;<sub>0</sub> = 1Å.</sup>
</p>

<p align="justify">
  <b>OBS. I</b>: If the number of components is greater than 1, the identification of spherical components, the molecular diameters, molecular lengths, and mole fractions must be entered successively on the same respective line, separated by a single space, as shown in the provided *.ini file.
</p>

<p align="justify">
  <b>OBS. II</b>: If, for any reason, the total mole fraction exceeds 1, it will be automatically normalized.
</p>

<p align="justify">
  <b>OBS. III</b>: The total number of particles may be slightly adjusted depending on the selected mole fractions.
</p>

<p align="justify">
  <b>OBS. IV</b>: The absolute temperature is only required to calculate the real pressure in MPa.
</p>

## <a name="filesandfolders"></a>Files and Folders

<p align="justify">
  The program organizes the output files and directories automatically. It creates <b>7</b> directories in total. To better organize the output files, all directories (or subdirectories) contains a date subfolder, corresponding to the starting date/hour of the simulation.
</p>

<p align="justify">
  The <code>Initial_Configuration/</code> directory stores the preset initial configuration file. It also contains the <code>OVITO/</code> subdirectory, which holds preformatted information on the position and orientation of particles, as well as their molecular geometry, that can be visualized directly on <a href="https://www.ovito.org/">OVITO</a> software. The <code>OVITO/</code> subdirectory also contains an 'RND' configuration file that is constantly updated to allow you to keep up with the development of the random configuration.
</p>

<p align="justify">
  The <code>Order_Parameter/</code> directory stores the nematic order parameter. This property is written out every <code>saving_frequency</code> cycles.
</p>

<p align="justify">
  The <code>Perturbed_Coefficient/</code> directory stores the calculated TPT coefficients and full Helmholtz free energy of the perturbed system. These properties are written out at the end of the simulation. If the square-well potential is selected, there will also be a subfolder for each attractive range point.
</p>

<p align="justify">
  The <code>Potential/</code> directory stores information on the potential energy calculated through the selected force field. This property is written out every <code>saving_frequency</code> cycles. If the control variable <code>potential_production_only</code> is set to <code>Y</code>, then only production cycles will be accounted for. If the square-well potential is selected, there will also be a subfolder for each attractive range point.
</p>

<p align="justify">
  The <code>Ratio/</code> directory stores information on equilibration cycles (acceptance ratio, maximum displacements, etc.). This information is sorted out into four subfolders: the <code>Rotation/</code> subfolder holds information on rotational moves; the <code>Translation/</code> subfolder holds information on translational moves; the <code>Volume/</code> subfolder holds information on volumetric moves (only valid for <i>NPT</i>-simulations); and the <code>Box/</code> subfolder holds information on the box volume and box length, including the current distortion of the simulation box (only valid for <i>NPT</i>-simulations). These properties are only written out every <code>adjustment_frequency</code> equilibration cycles.
</p>
  
<p align="justify">
  The <code>Results/</code> directory stores relavant results of the <i>NPT</i>-simulation, including the packing fraction, number density, and box volume. These properties are written out every <code>saving_frequency</code> cycles.
</p>

<p align="justify">
  The <code>Trajectories/</code> directory stores the trajectory file containing preformatted information on the position and orientation of particles, as well as their molecular geometry, that can be visualized directly on <a href="https://www.ovito.org/">OVITO</a> software. These properties are written out every <code>saving_frequency</code> cycles.<br><b>NOTE</b>: the trajectory is only written out if the parameter <code>print_trajectory</code> is set to <code>Y</code>.
</p>

<p align="justify">
  The aforementioned folders are created by executing a shell command via an intrinsic function called <code>SYSTEM</code> which works in Linux operating systems and Linux subsystems. Please note that which shell is used to invoke the command line is system-dependent and environment-dependent. Check this <a href="https://gcc.gnu.org/onlinedocs/gfortran/SYSTEM.html">link</a> for more information.
</p>

<p align="justify">
  Filenames are based on the information they hold, followed by the packing fraction (<i>NVT</i>-simulations) or reduced pressure (<i>NPT</i>-simulations) and the number of components that were used to create them. To prevent identically named files from being overwritten, a time prefix indicating when the simulation started is added to the file.
</p>

## <a name="running"></a>Running the Code

<p align="justify">
  Finally, it's time to run the code! After compilation, the executable(s) can be found in the <code>/bin/</code> folder:
</p>

**Standard compilation**
```
./mc_mixtures_standard.out
```

or

**Debug compilation**
```
./mc_mixtures_debug.out
```

<p align="justify">  
  First, when running the code, a summary of every property previously defined in the <b>*.ini</b> files will be printed out on the screen. If everything is OK, enter "Y" to continue. Otherwise, enter "N" to exit and edit something.
</p>

<p align="justify">
  The first thing the algorithm does is create the initial configuration folder and the initial configuration file. If you selected the random structure as the initial configuration, you can also check what stage the code is in while it builds the random configuration. After that, the algorithm creates the remaining folders and subfolders.
</p>

<p align="justify">
  Next, the algorithm checks if the initial configuration has any overlapping configurations. This is more relevant when using a preset initial configuration or selecting an SC, BCC, or FCC structure as the initial configuration. If the algorithm detects an overlapping configuration, it'll inform which particles are overlapping before exiting the program.
</p>

<p align="justify">
  Next, the property files are created and the real simulation starts. You can see what stage the simulation is at through the progress bar. When the simulation finishes, the program will write out a simulation log. This is automatically done after every simulation. The first simulation creates the simulation log file. Future simulations will only append information to the already existing log file.
</p>

## <a name="reporting"></a>Reporting Errors
<p align="justify">
  If you spot an error in the program files and all other documentation, please submit an issue report using the <a href="https://github.com/LESC-Unicamp/Monte-Carlo-Mixtures-of-Ellipsoids-Spherocylinders-Cylinders/issues">Issues</a> tab.
</p>

## <a name="citation"></a>Citing Us

N. B. de Souza, J. T. Lopes, L. F. M. Franco. Fluid Ph. Equilibria 2022, 561, 113543. DOI: <a href="https://doi.org/10.1016/j.fluid.2022.113543">10.1016/j.fluid.2022.113543</a>

---

“<i>With thermodynamics, one can calculate almost everything crudely; with kinetic theory, one can calculate fewer things, but more accurately; and with statistical mechanics, one can calculate almost nothing exactly.</i>” -- Eugene P. Wigner
